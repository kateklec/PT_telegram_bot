# PT_telegram_bot
## Описание
Это проект телеграмм-бота с базой данных и репликацией базы данных. Данный бот выполнен в рамках обучения PTStart.
Функционал бота:
* Сбор метрик с удаленной машины.
* Поиск в тексте и запись в БД номеров телефонов и почт
* Вывод логов репликации
* Проверка сложности пароля

## Запуск бота с помощью Docker

1. Склонируйте репозиторий себе на машину `git clone https://github.com/kateklec/PT_telegram_bot.git -b docker`
2. В директории с ботом, создайте файл `.env` и внесите туда свои данные по шаблону:
   ```
    TOKEN = токен телеграмм бота
    HOST_BOT = желаемый адрес для контейнера с ботом
    HOST = адрес удаленной машины для снятия метрик (Важно! на ней же должен находиться контейнер с БД)
    PORT = порт для подключения к удаленной машине
    USER = пользователь для подключения к удаленной машине (Важно! проверьте что пользователь имеет группу(ы) docker и/или root)
    PASSWORD = пароль от пользователя для подключения к удалённой машине
    USER_DB = имя пользователя для подключения к базе данных
    PASSWORD_DB = пароль для подключения к базе данных
    HOST_DB = желаемый адрес контейнера с базой данных
    PORT_DB = порт для подключения к базе данных
    DATABASE_DB = название базы данных
    POSTGRES_PASSWORD = пароль от базы данных
    DB_REPL_USER = repl_user # не изменять
    DB_REPL_PASSWORD = Qq12345 # не изменять
    REPL_DB_HOST = желаемый адрес контейнера с репликацией базы данных
    SUBNET = подсеть контейнеров( в формате: xxx.xxx.xxx.xxx/xx )
   ```
3. В директории с файлом `docker-compose.yaml` введите команду ` docker compose up --build `
4. Бот запущен и готов к работе.

## Запуск бота с помощью Ansible
Важно! Данный playbook писался для 2ух виртулаьных машин( Бот + БД и Репликация БД).
1. Склонируйте ветку Ansible себе на машину `git clone https://github.com/kateklec/PT_telegram_bot.git -b ansible`
2. В директории с проектом создайте файл `inventory.yml` и внесите туда свои данные по шаблону:
   ```
   all:
      vars:
          DB_REPL_USER: - имя пользователя для репликации
          DB_REPL_PASSWORD: - пароль от пользователя репликации 
          PG_VERSION: 14 - !не изменять!
          HOST_DB: - IP адрес машины, где будет находиться База данных
     hosts:
       host01:
         ansible_host: - IP адресс машины, где будут находить бот и база данных
         ansible_user: - имя пользователя на машине с ботом и БД (!Важно, для коректной работу у данного пользователя должны быть права на sudo NOPASSWD:ALL в файле /etc/sudoers)
         ansible_ssh_pass: - пароль от пользователя
         TOKEN: - токен вашего бота
         HOST: - IP удаленной машины для снятия метрик
         PORT: - порт для подключения к удаленной машине 
         USER: - пользователь на удаленной машине
         PASSWORD: - пароль от пользователя на удаленной машине
         USER_DB: - имя пользователя для базы данных
         PASSWORD_DB: - пароль от пользователя для базы данных
         PORT_DB: - порт для подключения к базе данных
         DATABASE_DB: - название базы данных
         DB_REPL_HOST: - IP адрес машины, где находится репликация базы данных
         DB_REPL_PORT: - порт для подключения для репликации базы данных
         ARCHIVE: "/oracle/pg_data/archive/" - директория Archive_mod
       host02:
         ansible_host: - IP адрес 2-ой машины с репликацией базы данных
         ansible_user: - пользователь для подключения ко 2-ой машине
         ansible_ssh_pass: - пароль для подключения ко 2-ой машине
   ```
3. В директории с playbook пропишите команду `ansible-playbook playbook_tg_bot.yml`
4. Сценарий готов